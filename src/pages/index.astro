---
import MainLayout from '../layouts/MainLayout.astro';
import movies from '../data/movies.json';
import MovieCard from '../components/MovieCard.astro';

// JSON'daki benzersiz kategorileri bulalım (Tekrar edenleri siler)
const categories = ["Tümü", ...new Set(movies.map(movie => movie.category))];
---

<MainLayout title="Anasayfa">
    <h1 class="page-title">Cineverse Keşfet</h1>
    
    <div class="filter-container">
        {categories.map(category => (
            <button class="filter-btn" data-category={category}>
                {category}
            </button>
        ))}
    </div>

    <div class="movie-grid" id="movie-grid">
        {movies.map((movie) => (
            // Her kartı bir div içine alıp kategorisini etiketliyoruz
            <div class="movie-wrapper" data-category={movie.category}>
                <MovieCard 
                    id={movie.id}
                    title={movie.title} 
                    description={movie.description} 
                    poster={movie.poster} 
                    rating={movie.rating} 
                />
            </div>
        ))}
    </div>
</MainLayout>

<script>
    // Sayfa yüklendiğinde çalışır
    const buttons = document.querySelectorAll('.filter-btn');
    const movies = document.querySelectorAll('.movie-wrapper') as NodeListOf<HTMLElement>;

    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            // 1. Tıklanan butonun kategorisini al
            const category = btn.getAttribute('data-category');

            // 2. Aktif buton stilini güncelle (Opsiyonel görsel şıklık)
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // 3. Filmleri kontrol et
            movies.forEach(movie => {
                const movieCategory = movie.getAttribute('data-category');

                if (category === 'Tümü' || category === movieCategory) {
                    movie.style.display = 'block'; // Göster
                } else {
                    movie.style.display = 'none'; // Gizle
                }
            });
        });
    });
</script>

<style>
    .page-title {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    /* Filtre Butonları Tasarımı */
    .filter-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 8px 16px;
        border: 2px solid #ddd;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        color: #555;
    }

    .filter-btn:hover {
        background: #f0f0f0;
        border-color: #bbb;
    }

    /* Seçili olan butonun stili (JS ile eklenir) */
    .filter-btn.active {
        background: #222;
        color: white;
        border-color: #222;
    }

    /* Film Grid Yapısı */
    .movie-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        padding: 1rem;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Animasyonlu geçiş için */
    .movie-wrapper {
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>